
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>What’s New In Tohil 4.2 &#8212; Tohil 4.3 documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pydoctheme.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Tohil 4.3 documentation"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="What’s New In Tohil 4.1" href="4.1.html" />
    <link rel="prev" title="What’s New In Tohil 4.3" href="4.3.html" />
    <link rel="canonical" href="https://docs.python.org/3/whatsnew/4.2.html" />
    
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
<link rel="shortcut icon" type="image/png" href="../_static/tohil.png" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script> 

  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <label for="menuToggler" class="toggler__label">
        <span></span>
    </label>
    <nav class="nav-content" role="navigation">
         <a href="https://github.com/flightaware/tohil" class="nav-logo">
             <img src="../_static/tohil.png" alt="Logo"/>
         </a>
        <div class="version_switcher_placeholder"></div>
        <form id="searchbox" role="search" class="search" action="../search.html" method="get">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                <path fill-rule="nonzero"
                        d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#444"></path>
            </svg>
            <input type="text" name="q" aria-label="Quick search"/>
            <input type="submit" value="Go"/>
        </form>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
  <h3><a href="../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">What’s New In Tohil 4.2</a><ul>
<li><a class="reference internal" href="#python-code-passed-to-tohil-exec-is-now-unindented-before-being-passed-to-python">Python code passed to tohil::exec is now unindented before being passed to Python</a></li>
<li><a class="reference internal" href="#additional-improvements">Additional Improvements</a></li>
<li><a class="reference internal" href="#bug-fixes">Bug Fixes</a></li>
<li><a class="reference internal" href="#improved-build-support">Improved Build Support</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="4.3.html"
                        title="previous chapter">What’s New In Tohil 4.3</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="4.1.html"
                        title="next chapter">What’s New In Tohil 4.1</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">Report a Bug</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/master/Doc/whatsnew/4.2.rst"
            rel="nofollow">Show Source
        </a>
      </li>
    </ul>
  </div>
        </nav>
    </div>
</div>

  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="4.1.html" title="What’s New In Tohil 4.1"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="4.3.html" title="What’s New In Tohil 4.3"
             accesskey="P">previous</a> |</li>

          <li><img src="../_static/tohil.png" alt="tohil logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://github.com/flightaware/tohil">Tohil</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">4.3 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">What’s New in Tohil</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">What’s New In Tohil 4.2</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" aria-label="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="what-s-new-in-tohil-4-2">
<h1>What’s New In Tohil 4.2<a class="headerlink" href="#what-s-new-in-tohil-4-2" title="Permalink to this headline">¶</a></h1>
<p>Welcome to Tohil 4.2.</p>
<p>4.2 is primarily a maintenance release, but includes at least one really
nice new feature:</p>
<section id="python-code-passed-to-tohil-exec-is-now-unindented-before-being-passed-to-python">
<h2>Python code passed to tohil::exec is now unindented before being passed to Python<a class="headerlink" href="#python-code-passed-to-tohil-exec-is-now-unindented-before-being-passed-to-python" title="Permalink to this headline">¶</a></h2>
<p>Tohil’s #1 new feature request!  Up until now, the argument to <code class="docutils literal notranslate"><span class="pre">tohil::exec</span></code>
had to obey Python indentation rules including there being no indentation at all
for the top level, leading to ugly stuff like:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>    <span class="n">tohil</span><span class="p">::</span><span class="n">exec</span> <span class="p">{</span>
<span class="k">def</span> <span class="nf">new_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>^ The “def” here has to occur at the beginning of the line, i.e. not be preceded
by any spaces or
tabs, or Python will raise an exception.  This nesting does not “read” well.</p>
<p>To make it easier to make your code read well and comply with Python indentation rules,
if the first nonblank line starts with whitespace, tohil::exec will un-indent the code block
such that the first line is not indented at all and following lines are undented
to match, all done lickety split, natively in C.</p>
<p>So you can now nest your embedded Python code in a more standard way:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">tohil</span><span class="p">::</span><span class="n">exec</span> <span class="p">{</span>
   <span class="k">def</span> <span class="nf">new_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="additional-improvements">
<h2>Additional Improvements<a class="headerlink" href="#additional-improvements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Added <code class="docutils literal notranslate"><span class="pre">-nonevalue</span></code> option to <code class="docutils literal notranslate"><span class="pre">tohil::call</span></code>, allowing the “none” sentinel
to be specified arbitrarily (Retains the default value of <code class="docutils literal notranslate"><span class="pre">tohil::NONE</span></code>.)</p></li>
<li><p>Cleaned up tohil namespace so <code class="docutils literal notranslate"><span class="pre">dir(tohil)</span></code> doesn’t show modules tohil imported as
if it had created them.</p></li>
<li><p>Made <code class="docutils literal notranslate"><span class="pre">package</span> <span class="pre">forget</span> <span class="pre">tohil</span></code> work.</p></li>
<li><p>Added support for the Tcl <code class="docutils literal notranslate"><span class="pre">unload</span></code> command to be able to unload the Tohil shared
library. (Consider it risky, though.)</p></li>
</ul>
</section>
<section id="bug-fixes">
<h2>Bug Fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Fixed crash when register_callback-registered functions raised a Python exception</p></li>
</ul>
</section>
<section id="improved-build-support">
<h2>Improved Build Support<a class="headerlink" href="#improved-build-support" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Added support for building tohil as a Debian package</p></li>
<li><p>Homebrew formula for building with homebrew</p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">What’s New In Tohil 4.2</a><ul>
<li><a class="reference internal" href="#python-code-passed-to-tohil-exec-is-now-unindented-before-being-passed-to-python">Python code passed to tohil::exec is now unindented before being passed to Python</a></li>
<li><a class="reference internal" href="#additional-improvements">Additional Improvements</a></li>
<li><a class="reference internal" href="#bug-fixes">Bug Fixes</a></li>
<li><a class="reference internal" href="#improved-build-support">Improved Build Support</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="4.3.html"
                        title="previous chapter">What’s New In Tohil 4.3</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="4.1.html"
                        title="next chapter">What’s New In Tohil 4.1</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">Report a Bug</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/master/Doc/whatsnew/4.2.rst"
            rel="nofollow">Show Source
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="4.1.html" title="What’s New In Tohil 4.1"
             >next</a> |</li>
        <li class="right" >
          <a href="4.3.html" title="What’s New In Tohil 4.3"
             >previous</a> |</li>

          <li><img src="../_static/tohil.png" alt="tohil logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://github.com/flightaware/tohil">Tohil</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">4.3 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >What’s New in Tohil</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">What’s New In Tohil 4.2</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" aria-label="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">Copyright</a> 2014, Aidan Hobson Sayers, 2021-2021, FlightAware LLC.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    See <a href="">History and License</a> for more information.
    <br /><br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    Last updated on Nov 23, 2021.
    <a href="https://docs.python.org/3/bugs.html">Found a bug</a>?
    <br />

    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.0.
    </div>

  </body>
</html>